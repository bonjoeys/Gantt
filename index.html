<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pilotage de l'Appel d'Offres</title>

    <!-- Importation de la biblioth√®que ApexCharts.js -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <style>
        /* Style g√©n√©ral */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            background-color: #f8f9fa;
            color: #3b4252;
            margin: 0;
            padding: 20px;
        }

        /* En-t√™te de la page avec logo */
        .main-header {
            display: flex;
            align-items: center;
            gap: 25px; /* Espace entre le logo et le titre */
            max-width: 1800px;
            margin: 0 auto 40px auto;
        }

        .logo {
            height: 50px;
        }

        h1 {
            text-align: left;
            color: #d08770;
            font-weight: 600;
            margin: 0; /* On retire les marges par d√©faut */
        }

        /* Conteneur principal avec layout Flexbox */
        .page-container {
            display: flex;
            flex-wrap: wrap; /* Permet de passer en colonne sur petits √©crans */
            gap: 30px;
            max-width: 1800px;
            margin: 0 auto;
        }

        /* Panneau de contr√¥le (gauche) */
        .controls-container {
            flex: 1;
            min-width: 450px;
            background-color: #ffffff;
            padding: 30px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            border-radius: 12px;
            border: 1px solid #e5e9f0;
        }
        .controls-container h2 {
            margin-top: 0;
            font-size: 1.4em;
            color: #2e3440;
            border-bottom: 2px solid #eceff4;
            padding-bottom: 10px;
        }

        /* Diagramme de Gantt (droite) */
        .gantt-container {
            flex: 2;
            min-width: 600px;
            background-color: #ffffff;
            padding: 30px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            border-radius: 12px;
            border: 1px solid #e5e9f0;
        }

        /* Style du tableau */
        #tasks-table {
            width: 100%;
            border-collapse: collapse;
        }
        #tasks-table th, #tasks-table td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #eceff4;
        }
        #tasks-table th {
            font-size: 0.9em;
            text-transform: uppercase;
            color: #4c566a;
        }
        #tasks-table td.task-name {
            font-weight: 500;
            cursor: help; /* Indique qu'une aide est disponible au survol */
        }
        #tasks-table input[type="date"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #d8dee9;
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        /* Bouton de r√©initialisation */
        .reset-button {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 20px;
            background-color: #5e81ac;
            color: #ffffff;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .reset-button:hover {
            background-color: #81a1c1;
        }

        /* Styles d'impression */
        @media print {
             @page { size: A4 landscape; margin: 1cm; }
            .controls-container, .reset-button { display: none; }
            .page-container, .main-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .gantt-container { width: 100%; max-width: 100%; flex: auto; box-shadow: none; border: none; }
        }
    </style>
</head>
<body>

    <div class="main-header">
        <img src="SGS_Logo.svg.png" alt="Logo SGS" class="logo">
        <h1>Pilotage de l'Appel d'Offres</h1>
    </div>

    <div class="page-container">
        
        <div class="controls-container">
            <h2>Tableau de Contr√¥le</h2>
            <div id="table-wrapper">
                <!-- Le tableau sera g√©n√©r√© par JavaScript ici -->
            </div>
            <button class="reset-button" id="reset-btn">R√©initialiser le planning</button>
        </div>

        <div class="gantt-container">
            <div id="gantt-chart"></div>
        </div>

    </div>

    <script>
        // --- DONN√âES INITIALES AVEC DESCRIPTIONS ---
        const initialTasks = [
            { id: 'task_ao', emoji: 'üì¢', name: "P√©riode d'appel d'offres", start: '2025-09-01', end: '2025-10-01', description: "Phase de publication de l'appel d'offres et de r√©ception des propositions initiales des fournisseurs. Les soumissionnaires pr√©parent leurs dossiers." },
            { id: 'task_analyse', emoji: 'üîé', name: 'Analyse des offres', start: '2025-10-01', end: '2025-10-08', description: "Ouverture et √©valuation des offres re√ßues selon les crit√®res d√©finis. Comparaison technique, fonctionnelle et financi√®re des propositions." },
            { id: 'task_qr', emoji: 'üí¨', name: 'Q/R aux soumissionnaires', start: '2025-10-08', end: '2025-10-13', description: "Session de clarification o√π les soumissionnaires peuvent poser des questions. L'objectif est de lever les ambigu√Øt√©s avant la soumission finale." },
            { id: 'task_shortlist', emoji: '‚úÖ', name: 'Com. shortlist fournisseurs', start: '2025-10-14', end: '2025-10-15', description: "Communication de la liste restreinte des fournisseurs retenus pour la phase suivante. Les candidats non retenus sont √©galement inform√©s." },
            { id: 'task_soutenance', emoji: 'üßë‚Äçüè´', name: "Soutenance / D√©monstration", start: '2025-10-20', end: '2025-10-24', description: "Pr√©sentation orale et d√©monstration de la solution par les fournisseurs shortlist√©s. Permet d'√©valuer la compr√©hension du besoin et la qualit√© du produit." },
            { id: 'task_finalisation', emoji: '‚úçÔ∏è', name: "Finalisation de l'offre", start: '2025-10-25', end: '2025-10-31', description: "Phase durant laquelle les fournisseurs ajustent leur offre finale. Int√®gre les retours des soutenances et des derni√®res clarifications." },
            { id: 'task_loi', emoji: '‚öñÔ∏è', name: 'D√©lib√©ration / LOI', start: '2025-11-05', end: '2025-11-06', description: "D√©cision finale du comit√© de s√©lection et r√©daction de la Lettre d'Intention (LOI). Officialise le choix du fournisseur avant la contractualisation." },
            { id: 'task_contrat', emoji: 'ü§ù', name: 'Contractualisation', start: '2025-11-05', end: '2025-12-19', description: "N√©gociation des termes finaux du contrat et validation juridique. Finalisation de tous les aspects l√©gaux, techniques et financiers." },
            { id: 'task_signature', emoji: 'üñãÔ∏è', name: 'Signature', start: '2025-12-24', end: '2025-12-25', description: "Signature officielle du contrat par toutes les parties. Marque le d√©but effectif de la collaboration avec le fournisseur choisi." }
        ];

        let currentTasks = [];

        // --- CONFIGURATION DU GRAPHIQUE ---
        const chartOptions = {
            series: [],
            chart: { height: 600, type: 'rangeBar' },
            plotOptions: { bar: { horizontal: true, borderRadius: 5, distributed: true } },
            colors: ['#e67e22'],
            xaxis: { type: 'datetime', labels: { datetimeUTC: false, style: { colors: '#888' } } },
            yaxis: { labels: { style: { fontSize: '14px', colors: '#3b4252' }, trim: false, maxWidth: 400 } },
            grid: { borderColor: '#e5e9f0', row: { colors: ['#f9fafb', '#ffffff'], opacity: 1 } },
            tooltip: { 
                theme: 'dark',
                // MISE A JOUR: Ajout de la description dans l'infobulle du graphique
                custom: function({ seriesIndex, dataPointIndex }) {
                    const task = currentTasks[dataPointIndex];
                    if (!task) return '';
                    const options = { year: 'numeric', month: 'long', day: 'numeric' };
                    const startDate = new Date(task.start).toLocaleDateString('fr-FR', options);
                    const endDate = new Date(task.end).toLocaleDateString('fr-FR', options);
                    const descriptionStyle = "font-style: italic; opacity: 0.9; margin-top: 10px; padding-top: 10px; border-top: 1px solid #4c566a; max-width: 300px;";

                    return `<div class="apexcharts-tooltip-box">
                        <div class="apexcharts-tooltip-title">${task.emoji} ${task.name}</div>
                        <div><strong>Du:</strong> ${startDate}</div>
                        <div><strong>Au:</strong> ${endDate}</div>
                        <div style="${descriptionStyle}">${task.description}</div>
                    </div>`;
                }
            },
            annotations: {
                xaxis: [{
                    x: new Date().getTime(),
                    borderColor: '#e44d26',
                    strokeDashArray: 2,
                    label: { text: 'Aujourd\'hui', borderColor: '#e44d26', style: { color: '#fff', background: '#e44d26' } }
                }]
            }
        };

        const chart = new ApexCharts(document.querySelector("#gantt-chart"), chartOptions);
        chart.render();

        // --- FONCTIONS ---
        function formatDataForChart(tasks) {
            return [{
                name: 'Planning',
                data: tasks.map(task => ({
                    x: `${task.emoji} ${task.name}`,
                    y: [ new Date(task.start).getTime(), new Date(task.end).getTime() ]
                }))
            }];
        }
        
        function saveTasks() {
            localStorage.setItem('ganttTasks', JSON.stringify(currentTasks));
        }

        function renderTable() {
            const tableWrapper = document.getElementById('table-wrapper');
            let tableHTML = `<table id="tasks-table">
                <thead>
                    <tr><th>√âtape</th><th>D√©but</th><th>Fin</th></tr>
                </thead>
                <tbody>`;
            
            currentTasks.forEach((task, index) => {
                // MISE A JOUR: Ajout de l'attribut "title" pour l'infobulle native du navigateur
                tableHTML += `
                    <tr>
                        <td class="task-name" title="${task.description}">${task.emoji} ${task.name}</td>
                        <td><input type="date" value="${task.start}" data-index="${index}" data-type="start"></td>
                        <td><input type="date" value="${task.end}" data-index="${index}" data-type="end"></td>
                    </tr>`;
            });

            tableHTML += `</tbody></table>`;
            tableWrapper.innerHTML = tableHTML;
            addTableListeners();
        }

        function updateChart() {
            chart.updateSeries(formatDataForChart(currentTasks));
        }

        function handleInputChange(event) {
            const index = event.target.dataset.index;
            const type = event.target.dataset.type;
            const value = event.target.value;

            currentTasks[index][type] = value;

            const task = currentTasks[index];
            if (new Date(task.end) < new Date(task.start)) {
                if(type === 'start') task.end = task.start;
                if(type === 'end') task.start = task.end;
                renderTable();
            }
            
            saveTasks();
            updateChart();
        }

        function addTableListeners() {
            document.querySelectorAll('#tasks-table input').forEach(input => {
                input.addEventListener('change', handleInputChange);
            });
        }
        
        function resetPlanning() {
            localStorage.removeItem('ganttTasks');
            loadTasks();
            renderTable();
            updateChart();
        }
        
        function loadTasks() {
            const savedTasks = localStorage.getItem('ganttTasks');
            currentTasks = savedTasks ? JSON.parse(savedTasks) : JSON.parse(JSON.stringify(initialTasks));
        }

        // --- INITIALISATION ---
        document.addEventListener('DOMContentLoaded', () => {
            loadTasks();
            renderTable();
            updateChart();
            document.getElementById('reset-btn').addEventListener('click', resetPlanning);
        });
    </script>
</body>
</html>

